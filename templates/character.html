<!-- 
    Under that: Relevant character stats:
        Average attacks per round, trained attacks
    On the left, an image of the character. Maybe a canvas of the character in animation for 
        part being highlighted for training.
    It will be a tab sort of thing, that displays info about the part being trained.
        It will show how much it has been trained already.
        It will also display the cost of training and a click to train button.
        No confirmation or anything. Just dumping it to the database.
    At the bottom, the ability to write a character biography
-->
{% extends "base.html" %}
{% block content %}
    <!-- If the user has no characters we can use "featurediscovery" to highlight where they should build their character-->
    <h3 class="center-align light-blue-text text-darken-4">
        {{ charactername.name|capitalize }}
    </h3> 
    <div class="row center-align">
        <img src="{{ url_for('static', filename = charactername.icon) }}" alt="">
    </div>
    <section id="stats">
        <!-- Private information -->

        {% if session.user == charactername.owner %}
        <div class="row">
            <div class="col m2">
                <h4>Hit points:</h4><p>{{ charactername.max_hp }}</p>
            </div>
            <div class="col m2">
                <h4>Energy</h4><p>{{ charactername.max_energy }}</p>
            </div>
            <div class="col m2">
                <h4>Armor:</h4><p>{{ charactername.ac }}</p>
            </div>
            <div class="col m2">
                <h4>Dodge chance:</h4><p>{{ charactername.dodge }}%</p>
            </div>
            <div class="col m2">
                <h4>Block chance:</h4><p>{{ charactername.block }}%</p>
            </div>
            <div class="col m2">
                <h4>Parry chance:</h4><p>{{ charactername.parry }}%</p>
            </div>
        </div>
        {% endif %}
        <!-- Public information -->
        <div class="row">
            <div class="col m6">
                <h4>Experience spent:</h4><p>{{ charactername.spent_exp }}</p>
            </div>
            <div class="col m6">
                <h4>Win/Loss:</h4><p>{{ charactername.winloss }}</p>
            </div>
        </div>
    </section>
    {% if session.user == charactername.owner %}
    <div class="row">
        <div class="col s12 m6">
            <h3>I'm gonna put like a cool canvas here</h3>
        </div>
        <div class="col s12 m6">
            <div class="card blue-grey darken-1">
                <h3 class="center-align">Body Training</h3>
                <ul class="pagination">
                    <li class="active" id="train-card-1"><a href="#!" onclick="moveActive(event)">Torso</a></li>
                    <li class="waves-effect" id="train-card-2"><a href="#!" onclick="moveActive(event)">Arms</a></li>
                    <li class="waves-effect" id="train-card-3"><a href="#!" onclick="moveActive(event)">Hands</a></li>
                    <li class="waves-effect" id="train-card-4"><a href="#!" onclick="moveActive(event)">Legs</a></li>
                </ul>
                <div class="row torso">
                    <h3>Torso Training</h3>
                    <p>The inward fist's core can be rigorously trained and is key to withstanding attacks.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action" id="action-torso">
                        <h5>Current level: {{ charactername.torso }}</h5>
                        <h5>Cost for next level:<span id="cost-torso"></span></h4>
                        <a class="btn-floating btn-large waves-effect waves-light red" id="train-torso"><i class="material-icons">add</i></a><h5><span id="field-torso">0</span><span id="max-torso"></span></h5>
                        <h5>Total cost: <span id="total-torso">0</span></h5>
                    </div>
                </div>
                <div class="row hands hidden">
                    <h3>Hands Training</h3>
                    <p>The Inward Fist can train their hands to harden them, increasing the damage they can inflict.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action" id="action-hands">
                        <h5>Current level: {{ charactername.hands }}</h5>
                        <h5>Cost for next level:<span id="cost-hands"></span></h4>
                        <a class="btn-floating btn-large waves-effect waves-light red" id="train-hands"><i class="material-icons">add</i></a><h5><span id="field-hands">0</span><span id="max-hands"></span></h5>
                        <h5>Total cost: <span id="total-hands">0</span></h5>
                    </div>
                </div>
                <div class="row legs hidden">
                    <h3>Legs Training</h3>
                    <p>The inward fist's legs and feet can be trained for speed and power, increasing the power of their kicks.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action" id="action-legs">
                        <h5>Current level: {{ charactername.legs }}</h5>
                        <h5>Cost for next level:<span id="cost-legs"></span></h4>
                        <a class="btn-floating btn-large waves-effect waves-light red" id="train-legs"><i class="material-icons">add</i></a>
                        <h5>
                            
                            <span id="field-legs">0</span>
                            <span id="max-legs"></span>
                        </h5>
                        <h5>Total cost: <span id="total-legs">0</span></h5>
                    </div>
                </div>
                <div class="row arms hidden">
                    <h3>Arms Training</h3>
                    <p>The inward fist's arms can be trained for speed and power, allowing them to block attacks with increased alacrity.</p>
                    <div class="card-action" id="action-arms">
                        <h5>Current level: {{ charactername.arms }}</h5>
                        <h5>Cost for next level:<span id="cost-arms"></span></h4>
                        <a class="btn-floating btn-large waves-effect waves-light red" id="train-arms"><i class="material-icons">add</i></a>
                        <h5>
                            <form method="POST">
                                <span name="field-arms" id="field-arms">0</span>                                
                                <button class="btn waves-effect waves-light" type="submit" name="form-name" value="arms">Train
                                    <i class="material-icons right"></i>
                                </button>
                            </form>
                            <span id="max-arms"></span>
                        </h5>
                        <h5>Total cost: <span id="total-arms">0</span></h5>
                    </div>
                </div>
                
            </div>
        </div>

        <div class="col s12 m6">
            <div class="card blue-grey darken-1">
                <h3 class="center-align">Disciplines</h3>
                <ul class="pagination">
                    <li class="active" id="train-card-1"><a href="#!" onclick="moveActive(event)">Truesight</a></li>
                    <li class="waves-effect" id="train-card-2"><a href="#!" onclick="moveActive(event)">Levitation</a></li>
                    <li class="waves-effect" id="train-card-3"><a href="#!" onclick="moveActive(event)">Roundhouse</a></li>
                    <li class="waves-effect" id="train-card-4"><a href="#!" onclick="moveActive(event)">Inner-Fire</a></li>
                    <li class="waves-effect" id="train-card-4"><a href="#!" onclick="moveActive(event)">Pheonix-Fire</a></li>
                    <li class="waves-effect" id="train-card-4"><a href="#!" onclick="moveActive(event)">Dim-Mak</a></li>
                </ul>
                <div class="row truesight">
                    <h3>Truesight</h3>
                    <p>By training their senses and awareness of the energies of chakra, the inward fist can detect things not seen by the physical eye alone.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                <div class="row levitation hidden">
                    <h3>Levitation</h3>
                    <p>Through focus, determination and sheer inner will, the inward fist can lift themselves from the shackles of the earth.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                <div class="row roundhouse hidden">
                    <h3>Roundhouse</h3>
                    <p>A simple but effective attack that can hit multiple enemies.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                <div class="row inner-fire hidden">
                    <h3>Inner Fire</h3>
                    <p>By turning their focus inward and allowing their ki to flow through their body, the inward fist can burn away impurities in the body.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                <div class="row pheonix-fire hidden">
                    <h3>Pheonix Fire</h3>
                    <p>The inward fist can train themselves to redirect their flow of ki, empowering their attacks at the cost of their speed.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                <div class="row dim-mak hidden">
                    <h3>Dim-Mak</h3>
                    <p>Using their knowledge of Ki in all things, the inward fist can use their own energy to throw off the alignment of energy in others, essentially poisoning their energy.</p>
                    <!-- Cost: 1500 * isquare(current value + 1)-->
                    <div class="card-action">
                        <a href="#">Cost</a>
                        <a href="#">Train this Discipline</a>
                    </div>
                </div>
                
            </div>
        </div>
        <div class="col s12 m6">
            <h3>I'm gonna put like a cool canvas here</h3>
        </div>
    </div>

    <!-- Edit character bio, delete character -->

    {% endif %}
    <script>
        var torso = "{{ charactername.torso }}"
        var hands = "{{ charactername.hands }}"
        var arms = "{{ charactername.arms }}"
        var legs = "{{ charactername.legs }}"
        /*
        if (arms >= 100) {
            document.getElementById("action-arms").innerHTML = "<h3> Your arms are trained to maximum </h3>"
        } else {
            document.getElementById("cost-arms").innerHTML = calculateCost(arms, 1)
            document.getElementById("train-arms").addEventListener("click", function(){  // Listen for a click
                if (parseInt(arms) + parseInt(document.getElementById("field-arms").innerHTML) >= 100) {
                    document.getElementById("max-arms").innerHTML = " Maximum level reached."
                } else{
                    let current = parseInt(document.getElementById("field-arms").innerHTML);           // Store the current value of arms training   
                    document.getElementById("field-arms").innerHTML = parseInt(current) + 1;
                    let next = calculateCost(current + 1, 1); //OK
                    document.getElementById("cost-arms").innerHTML = next;
                    let totalExperience = calculateCost(arms, current + 1);
                    document.getElementById("total-arms").innerHTML = totalExperience;
                }
            })
        }
        */

        function calculateCost(number, iterations) {
            let initialValue = parseInt(number) + 1;
            let result = 0;
            for (let i = 0; i < iterations; i++) {
                result += Math.sqrt(initialValue) * 1500;
                initialValue++;
            }
            return Math.round(result);
        }
        // Building the for loop of the ages
        bodyTraining = [torso, hands, arms, legs];
        bodyString = ["torso", "hands", "arms", "legs"]
        for (let i = 0; i < bodyTraining.length; i++) {
            console.log(bodyTraining[i])
            if (bodyTraining[i] >= 100) {
                document.getElementById("action-" + bodyString[i]).innerHTML = "<h3> Your " + bodyString[i] + " are trained to maximum </h3>"
                } else {
                document.getElementById("cost-" + bodyString[i]).innerHTML = calculateCost(bodyTraining[i], 1)
                document.getElementById("train-" + bodyString[i]).addEventListener("click", function(){
                    if (parseInt(bodyTraining[i]) + parseInt(document.getElementById("field-" + bodyString[i]).innerHTML) >= 100) {
                        document.getElementById("max-" + bodyString[i]).innerHTML = " Maximum level reached."
                    } else{
                        let current = parseInt(document.getElementById("field-" + bodyString[i]).innerHTML);  
                        document.getElementById("field-" + bodyString[i]).innerHTML = parseInt(current) + 1;
                        let next = calculateCost(current + 1, 1); //OK
                        document.getElementById("cost-" + bodyString[i]).innerHTML = next;
                        let totalExperience = calculateCost(bodyTraining[i], current + 1);
                        document.getElementById("total-" + bodyString[i]).innerHTML = totalExperience;
                    }
                })
            }
        }
        
        function moveActive() {
            parent = event.target.parentNode.parentNode.firstElementChild;
            while (parent){
                if (parent.className == "active") {
                    parent.className = "waves-effect"
                    let childText = parent.firstElementChild.innerHTML.toLowerCase()
                    let hideIt = document.getElementsByClassName(childText)
                    hideIt[0].style.display = "none"
                } else {
                    parent = parent.nextElementSibling
                }
            }
            
            if (event.target.parentNode.className !== "active") {
                event.target.parentNode.className = "active"
                let childText = event.target.innerHTML.toLowerCase() 
                let showIt = document.getElementsByClassName(childText)
                console.log(showIt[0])
                showIt[0].style.display = "block"
                console.log(showIt[0])
            }
        }
    </script>
{% endblock %}